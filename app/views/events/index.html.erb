<!DOCTYPE html>
<html>
<head>
  <title>Event Tracking</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
</head>
<body>

<h1>Event Tracking</h1>

<button id="trackEventA">Track Event A</button>
<button id="trackEventB">Track Event B</button>

<%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
<script>
  // jQuery code for handling button clicks and making AJAX requests
  $(document).ready(function() {
    $('#trackEventA').click(function() {
      trackEvent('Event A');
    });

    $('#trackEventB').click(function() {
      trackEvent('Event B');
    });

    function trackEvent(eventName) {
      $.ajax({
        url: '/api/events/track',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({ eventName: eventName, "email": "user@example.com", "userId": "123", "apiKey": "valid_api_key" }),
                          // "eventName": "Event A", "email": "user@example.com", "userId": "123", "apiKey": "valid_api_key"
        success: function(response) {
            // Valid - 200
            // Reference curl parameters:
            // curl -X POST -H "Content-Type: application/json" -d '{"eventName": "Event A", "email": "user@example.com", "userId": "123", "apiKey": "valid_api_key"}' http://localhost:3000/api/events/track
            // {"msg":"Event A tracked successfully","code":"Success","params":{}}
            alert(response['msg']); // Show success message
          },
         // error: function(xhr, status, error) {
         //   alert(`Error : ${xhr.status} - ` + xhr.responseJSON.msg); // Show error message
         // }
        error: function(xhr, status, error) {
          if (xhr.status == 400) {
            // Invalid Parameters - 400
            // Reference curl parameters:
            // curl -X POST -H "Content-Type: application/json" -d '{"eventName": "Event A", "userId": "123", "apiKey": "valid_api_key"}' http://localhost:3000/api/events/track
            // {"msg":"Invalid parameters","code":"InvalidParameters","params":{}}
            alert(xhr.responseJSON.msg); // Show error message for invalid parameters
          } else if (xhr.status == 401) {
            // Invalid API Key - 401
            // Reference curl parameters:
            // curl -X POST -H "Content-Type: application/json" -d '{"eventName": "Event A", "email": "user@example.com", "userId": "123", "apiKey": "invalid_api_key"}' http://localhost:3000/api/events/track
            // {"msg":"Invalid API key","code":"BadApiKey","params":{}}
            alert(xhr.responseJSON.msg); // Show error message for invalid API key
          } else {
            // Other error statuses
            alert('Error: ' + error); // Show generic error message
          }
        }
      });
    }
  });
</script>

</body>
</html>
